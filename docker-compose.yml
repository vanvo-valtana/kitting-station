version: '3.8'

services:
  app:
    # Our "Lab" container for JetPack 6.2.1
    # Ref: https://docs.nvidia.com/deeplearning/frameworks/install-pytorch-jetson-platform-release-notes/pytorch-jetson-rel.html
    # Ref2: https://docs.nvidia.com/deeplearning/frameworks/pytorch-release-notes/rel-25-04.html#rel-25-04
    build: .
    
    # Mount our project folder into the container
    volumes:
      - ./:/app
      
    # Pass through the STM32 Nucleo board
    devices:
      - /dev/video0
      
    # This is the key: gives the container GPU access
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
              
    # Keep the container alive for us to exec into
    # We will 'docker compose run' for main tasks
    command: tail -f /dev/null